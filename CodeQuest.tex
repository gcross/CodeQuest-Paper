%@+leo-ver=4-thin
%@+node:gcross.20090405101642.3:@thin CodeQuest.tex
%@@language latex

%@<< Prelude >>
%@+node:gcross.20090405101642.4:<< Prelude >>
\documentclass[twocolumn,showpacs,preprintnumbers,amsmath,amssymb,nofootinbib,pra,floatfix]{revtex4-1}

\usepackage{mathrsfs,amsthm,clrscode,comment}

\newtheorem{theorem}{Theorem}
\newtheorem{proposition}{Proposition}
\newtheorem{lemma}{Lemma}
\newtheorem{corolary}{Corolary}

\newenvironment{definition}[1][Definition]{\begin{trivlist}
\item[\hskip \labelsep {\bfseries #1}]}{\end{trivlist}}

\newenvironment{example}[1][Example]{\begin{trivlist}
\item[\hskip \labelsep {\bfseries #1}]}{\end{trivlist}}
\newenvironment{remark}[1][Remark]{\begin{trivlist}
\item[\hskip \labelsep {\bfseries #1}]}{\end{trivlist}}

%@-node:gcross.20090405101642.4:<< Prelude >>
%@nl

%@<< Macros >>
%@+node:gcross.20091029172439.1256:<< Macros >>
\newcommand{\lst}{\vec}
\newcommand{\set}{\tilde}

\newcommand{\genfun}{\mathcal{G}}
\newcommand{\pauligroup}{\mathfrak{P}}
\newcommand{\powerset}{\mathcal{P}}
\newcommand{\centralizer}{\mathcal{C}}

\input{macros.tex}
%@-node:gcross.20091029172439.1256:<< Macros >>
%@nl

\begin{document}

%@+others
%@+node:gcross.20090513124712.1:Title Page
\title{CodeQuest}

\author{Gregory M. Crosswhite}
\affiliation{Department of Physics\\ University of Washington\\ Seattle, 98185}

\author{Dave Bacon}
\affiliation{Department of Computer Science \& Engineering \\ Department of Physics \\ University of Washington \\ Seattle, 98185}

%\pacs{03.67.-a}

\email{gcross@phys.washington.edu, dabacon@cs.washington.edu}


\maketitle

\newpage

\tableofcontents
%@-node:gcross.20090513124712.1:Title Page
%@+node:gcross.20090405101642.5:Introduction
In the field of quantum computing, there is a grand battle between the
forces of humankind, which seek to reliably store and manipulate
quantum information, and the forces of nature, which generally seek to
destroy it.  Although armies of experimentalists have made hereoic
efforts to build systems that shield quantum information from harm,
nature inevitably manages to get past these defences from time to time
and strike a blow.  This might seem to paint a grim outlook for the
possibility of building a quantum computer, but happily it turns out
to be the case that one can generally repair damage to quantum
information as long as one knows the exact form that the damage took,
and furthermore that one can build a `trap' --- that is to say, a
\emph{quantum code} --- that tricks nature into giving this
information up.

Now, the nature of codes is that they decouple the space in which our
computation lives from the space in which the physical information is
stored; that is to say, although we design our quantum circuit to
operate on some space of qubits $\mathscr{C}$, each of these qubits
does \emph{not} directly correspond to a physical qubit, but rather
there is some isomorphism that relates the entire space $\mathscr{C}$
to the space of physical qubits, $\mathscr{P}$.  To distinguish
between these two spaces, we shall call the space of qubits in whose
terms the computation is expressed the \emph{computational space}, and
the space of qubits which have physically been built the
\emph{physical space}.

Of course, merely building an isomorphism between these two spaces is
not enough to allow us to correct errors.  For one thing, we need to
add extra qubits to the computational space that contain a record of
the damage that we can read out; thus, we shall say that the full
computational space is $\mathscr{C}:=\mathscr{R}\times\mathscr{Q}$,
where the qubits that live in $\mathscr{R}$ have the role of keeping a
record of the errors that have been introduces, and the qubits that
live in $\mathscr{Q}$ are the qubits in whose terms our quantum
algorithm is expressed.  Since we are only performing measurements on
$\mathscr{R}$, we can effectively ignore all operators except, say,
the $Z$ measurement operator for each qubit; this set of commuting
operators allows us to completely measure the state of qubits in
$\mathscr{R}$.  In order to build the `trap' element into our system,
we need to ensure that whenever nature strikes at the physical space
$\mathscr{P}$, it is isomorphic to a strike on the computational space
that leaves a \emph{measureable} record in $\mathscr{R}$, which means
in particular that it is isomorphic to an operator that must
\emph{anti-commute} with the $Z$ operator (or whatever else we have
chosen to be our basis of measurement) of one of the qubits in
$\mathscr{R}$.  Note that although we speak of measuring the qubits in
$\mathscr{R}$, they of course cannot be measured directly, but instead
we take the measurement operator of interest in $\mathscr{R}$ and
measure the \emph{isomorphic} operator in the physical space
$\mathscr{P}$; this isomorphic operator is referred to as a
\emph{stabilizer}, and the full set of operators on $\mathscr{P}$
which are isomorphic to our chosen measurement operators on
$\mathscr{R}$ are referred to as the \emph{stabilizers} of the code.

Up to this point, the formalism we have described is known as
\emph{stabilizer codes} and its essential characteristic is the
forcing of every qubits in $\mathscr{R}$ to always have a definite
value in some basis by performing continuous measurement.  What if,
however, we relaxed this constraint and only continuously measured
some of the qubits in $\mathscr{R}$?  That is to say, what if we split
the qubits in $\mathscr{R}$ into two catagories: \emph{stabilizer
qubits} whose states we care about and force to always have a definite
value in some basis through continuous measurement, \emph{gauge
qubits} whose states we do not care about.  (The latter get their name
from the fact that they provide a `gauge' degree of freedom, i.e. a
degree of freedom that is irrelevent to us.)  Then we would have that
$\mathscr{R}=\mathscr{S}\times \mathscr{G}$, where $\mathscr{S}$ is
the space in which the stabilizer qubits live, and $\mathscr{G}$ is
the space in which the so-called gauge qubits live; such a scheme is
known as a \emph{subsystem code}.  In this case, we shall use the term
\emph{stabilizers} to denote the set of operators in $\mathscr{P}$
which are isomorphic to our chosen measurement operators of interest
in $\mathscr{S}$.

At first there might not seem to be an advantage to this approach,
since it essentially means adding qubits to our code that are
`wasted'; however, in practice this can actually make our code easier
to implement in a physical system.  The reason for this is that often
the measurement of stabilizers requires performing operations that
involve several qubits at once, which can be difficult or impossible
to implement\footnote{See, for example, the \emph{toric code} [ref],
which uses 4-qubit measurements.}  However, there are ways that by
adding additional qubits, one can instead use a set of, say, 2-qubit
operators whose simultaneous measurement results in an effective
measurement of all of the stabilizers so that the stabilizer qubits
are all collapsed to definite values in our chosen basis\footnote{For
examples of this, see the compass model code [ref].}.

What makes this approach powerful is that we no longer need our
measurements on the physical system to commute with each other, as
long as they all commute with the stabilizers, since then the fact
that they do not commute only affects the gauge qubits, which we do
not care about.  In fact, it is so powerful that any set of
measurements that are members of the Pauli group on the physical
qubits can be used to implement a subsystem code, and in fact we can
compute the code that it implements, as we shall prove in this paper;
of course, the resulting code might not be useful --- since among
other possibilities, it might be that it has no room for encoding the
quantum information that we want to store --- but it definitely
exists.  This fact invites an approach to finding useful subsystem
codes that is in many ways opposite to the approach commonly taken:
rather than coming up with codes and then trying to figure out how
they might be physically implemented, why not start with a class of
physical implementations and search within it for useful subsystem
codes?  This is the approach that we explore in this paper.

In the first section, we shall formally prove that every set of
measurements that are members of the Pauli group acting on the system
give rise to a subsystem code, and we shall in the process present
algorithms for computing this code (or at least, for computing one
such code, since it is not unique) and its distance.  In the second
section, we shall present numerical results obtained by applying a
code implementing this algorithm to explore systems built using
lattices that take the form of te 11 regular tilings.  In the third
section, we shall present an algorithm for seaching over all of the
systems that can be implemented by using arbtitrary Ising interactons
with the structure of a graph, and then we shall present the results
that we have obtained from our searches.
%@-node:gcross.20090405101642.5:Introduction
%@+node:gcross.20090423002455.2:Algorithm
\section{Algorithm}

%@+node:gcross.20090423002455.3:Stabilizers and gauge qubits
\subsection{Construction of the subsystem code}

\begin{remark}
This subsection describes by way of a constructive proof how one can compute the quantum subsystem code implemetable by a the set of measurement operators.  For a listing of pseudo-code that implements the algorithm described in this proof, see Table \ref{code-algorithm} near the end of this subsection.
\end{remark}
%@+node:gcross.20090520163423.14:Introduce main theorem
Although conceptually a subsystem code is an isomorphism $T$ such that  $\mathscr{P}\approx^T \mathscr{S}\times\mathscr{G}\times\mathscr{Q}$ --- that is, an isomorphism between the \emph{physical} space of qubits and the \emph{computational} space of qubits in whose terms our computation is actually expressed, we do not need to actually construct this isomorphism in order to be able to use the code.  Since all of our work will be done on the physical system anyway, it suffices to know the operators in the physical space $\mathscr{P}$ that are isomorphic to the qubit measurement operators of interest in the computational space $\mathscr{S}\times\mathscr{G}\times\mathscr{Q}$, and it is exactly the operators on $\mathscr{P}$ that the algorithm we present shall compute\footnote{If one really wanted to, one could explicitly construct the isomorphism $\mathscr{T}$ from these operators by computing the unitary operator which simultaneously diagonalizes a the maximal subset of commuting measurements from this set of operators on $\mathscr{P}$, but in practice this is not particularly useful.}.

When one wants to define a qubit in terms of its measurement operators, it suffices to define two operators that anti-commute with each other but which commute with all of the others measurement operators that have been defined, since this gives us the $X$ and $Z$ measurements on the qubit which are sufficient to generate the full $Pauli$ group (minus phases).  Since working with such pairs of operators shall be a common theme in our algorithm, we shall introduce the following definition in order to simplify the language used to describe them.

\begin{definition} A pair of operators is a \emph{conjugal pair in relation to the set} $\set X$ when each of the operators in the pair commutes with every operator in $\set X$ except for its \emph{conjugal partner} --- that is, the other operator in the conjugal pair --- should its conjugal partner be a member of $\set X$.
\label{conjugal-pair-definition}
\end{definition}

Note that we have explicitly not required that the operators in the conjugal pair be members of $\set X$ in order to be a conjugal pair in relation to it.  However, should both operators be members of $\set X$, then neither operator can belong to a different conjugal pair with respect to $\set X$, since in that case there would be an operator in $\set X$ (namely, its original conjugal partner) with which it anti-commutes that was not its conjugal partner in the new pair, leading to a contradiction.

For convenience, we introduce the following additional definitions:

\begin{definition}

\begin{enumerate}
\item $\pauligroup$ is the group of Pauli operators --- that is, the group of tensor products of the (unnormalized) Pauli matrices --- acting on the physical space $\mathscr{P}$;
\item $\powerset(\set S)$ is the power set of $\set S$, i.e. the set of all subsets of $\set S$; and
\item $\centralizer_\mathfrak{G}(\set S)$ is the centralizer of $\set S$, that is the subgroup of elements in $\mathfrak{G}$ which commute with $\set S$;
\item the function $\genfun:\powerset(\pauligroup)\to\powerset(\pauligroup)$ is defined such that $\genfun(\set S)$ is the set of all possible products of operators in $\set S$ --- that is, it is the set \emph{generated} by $\set S$.
\end{enumerate}

\end{definition}

We now introduce the main theorem of this subsection.

\begin{theorem} \label{theorem-SG} Suppose we are given a sequence of Pauli operators, $\lst O$.  Then there exist sets of Pauli operators $\set S\subseteq\pauligroup$, $\set G\subseteq\pauligroup$, and $\set L\subseteq\pauligroup$ such that
\begin{enumerate}
\item each of the operators in $\set S \cup \set G \cup \set L$ is independent from the rest --- i.e., no operator in this (unioned) set can be written as a product of other operators in the set;
\item each operator in $\set L \cup \set G$ is a member of a conjugal pair in relation to $\set S \cup \set G \cup \set L$;
\item $\genfun(\set S \cup \set G)=\genfun\paren{\{\lst O_i\}}$\footnote{Here we use the notation $\{\vec{O}_i\}$ to refer to the set of elements in the sequence $\vec{O}$.};
\item and $\genfun(\set S \cup \set G \cup \set L)=\centralizer_\pauligroup(\set S)$
\end{enumerate}
\end{theorem}

\begin{remark}
The main work in the proof of this theorem will be performed by proving several related propositions.  First we shall show how the set $\set G$ and a sequence $\lst S$ are constructed from the sequence of operators $\lst O$.  Since we want our stabilizers to form an independent set of operators, we shall then show that through a Gaussian elimination procedure it is possible to extract a list of independent operators from a sequence $\lst S$ resulting in a set $\set S$.  Finally, we shall show how using this same Gaussian elimination procedure we can transform a subset of the operators of $\set S\cup\set G$ into a form that makes it trivial to compute the logical qubit operators $\set L$.
\end{remark}
%@nonl
%@-node:gcross.20090520163423.14:Introduce main theorem
%@+node:gcross.20090519160701.3:Construction of sequences
\begin{proposition} \label{proposition-SG} Suppose that we are given a sequence of Pauli operators $\lst O\subseteq \pauligroup$.  Then there exists a sequence of Pauli operators $\lst S\subseteq\pauligroup$ and a set of Pauli operators $\set G\subseteq\pauligroup$ such that
\begin{enumerate}
\item all of the operators in $\lst S$ commute with each other and also all of the operators in $\lst G$; \label{stabs-commute-with-G}
\item each operator in $\set G$ is a member of a \emph{conjugal pair} (Definition \ref{conjugal-pair-definition}) in relation to $\{\lst S_i\} \cup \set G $ \label{conjugal-pairs-commute-with-SAG}; and
\item $\genfun\paren{\{\lst S_i\}\cup \set G}=\genfun\paren{\{\lst O_i\}}$ \label{SAG-spans-all}.
\end{enumerate}
\end{proposition}

\begin{proof}
Proof by induction.  For the base case, note that if $\lst O$ is empty then $\lst S:=\emptyset$ and $\set G:=\emptyset$ trivially satisfy all properties.

Now assume that the proposition holds for a sequence of length $n-1$, and consider a sequence of operators $\lst O$ of length $n$.  By the inductive hypothesis, we know that there is a sequence $\lst S'$ and a set $\set G'$ satisfying the properties above for the subsequence of $\lst O$ consisting of the first $n-1$ operators.  Let $o:=\lst O_n\cdot \prod_{g\in \set G, \{\lst O_n,g\}=0} \text{conj}_{\set G}(g)$ --- that is, the product of $\lst O_n$ with the conjugal partner of every operator in $\set G$ with which $\lst O_n$ anti-commutes.  This definition guarantees that $o$ commmutes with every operator in $\set G$;  furthermore, we can obtain $\lst O_n$ back from $o$ since every operator in $\set G$ squares to the identity and thus $\lst O_n=o\cdot \prod_{g\in \set G, \{\lst O_n,g\}=0} \text{conj}_{\set G}(o)$; therefore we conclude that $\genfun\paren{\{\lst S'_i\} \cup \set G' \cup \{o\}}=\genfun\paren{\{\lst O_i\}}$.

If $o$ commutes with every operator in $\lst S'$, then set
$$\lst S_i :=
\begin{cases}
\lst S'_i & i \le n-1 \\
o & i = n
\end{cases}
$$
and $\set G := \set G'$, and we are done.  Otherwise, let $s$ be some operator in $\lst S'$ that anti-commutes with $o$, $\set G:=\set G'\cup \{s,o\}$
\footnote{Observe that neither $o$ nor $s$ can be present in $\set G'$ since they commute with every operator in $\set G'$, so the new set $\set G:=\set G'\cup \{s,o\}$ gives us a strictly larger set.  This fact is irrelevant far as the proof is concerned, but it has the important consequence that a computer code implementing the algorithm described by this proof can append $s$ and $o$ to a list of gauge operators and assume that this list continues to form a set (i.e., a sequence without duplicates) without having to explicitly check for this.}, $\lst S_i'' := f(\lst S'_i)$, and $\lst S$ be the subsequence of $\lst S''$ with the identity operators removed, where
$$
f(s') :=
\begin{cases}
s'\cdot s & \{s',o\}=0\\
s' & \text{otherwise}
\end{cases}.
$$
Observe that by this definition, all of the operators in $\lst S$ commute with every operator in $\set G$, so property \ref{stabs-commute-with-G} is satisfied.  Since the only difference between $\set G'$ and $\set G$ is the addition of $s$ and $o$, which form a conjugal pair with respect to $\{\lst S_i\} \cup \set G$, we conclude that property \ref{conjugal-pairs-commute-with-SAG} is satisfied.
Lastly, since $s\in \set G$, we can form any operator in $\lst S'$ with products of operators in $\lst S$ and $\set G$, so therefore $\genfun\paren{\{\lst S_i\} \cup \set G}=\genfun\paren{\{\lst S'_i\} \cup G' \cup \{s,o\}}=\genfun\paren{\{\lst O_i\}}$, and so the final property is satisfied.

We conclude by noting that since all of the operators in $\lst S$ and $\set G$ were formed from products of operators in $\lst O$, which are Pauli operators (i.e., members of the group $\pauligroup$), they are Pauli operators themselves.
\end{proof}
%@-node:gcross.20090519160701.3:Construction of sequences
%@+node:gcross.20090519160701.4:Making them independent
\begin{remark}
A consequence of not requiring independence of the operators in $\lst O$ is that the operators $\lst S$ given by Proposition \ref{proposition-SG} are not necessarily independent.  Happily, since all of these operators can be expressed as tensor products of Pauli operators, we can construct a set of independent operators by performing an analog of Gaussian elimination.
\end{remark}

\begin{proposition}
\label{make-independent-using-elimination}
Suppose that we have been given a sequence of Pauli operators which commute with each other, $\lst R$.  Then there exists
\begin{enumerate}
\item a sequence $\lst S$ of $n$ independent operators such that $\genfun\paren{\{\lst S_i\}}=\genfun\paren{\{\lst R_i\}}$,
\item a sequence of $n$ integers without duplicates in the inclusive range $1\dots n$,
\item and a map $p:\{1\dots n\} \to \{0,1\}$ such that $\lst S_i$ is the only operator in $\lst S$ that anti-commutes with $P_{k_i}^{[p(i)]}$, where $P_k^{[0]}:=X_k$ and $P_k^{[1]}:=Z_k$.
\end{enumerate}
\end{proposition}

\begin{proof}
Proof by induction.  For the base case, we observe that if $\lst R$ is empty, then the trivial sequences $\lst S:=\emptyset$ and $\lst k :=\emptyset$ and the trivial function $p:\emptyset\to\emptyset$ satisfy the requirements.

Now suppose that we know the proposition holds for sequences of length $N-1$, and we are given a sequence $\lst S$ of length $N$.  By our inductive hypothesis, we can apply the proposition to the first $N-1$ operators in $\lst R$ obtain sequences $\lst S'$ and $\lst k'$ of length $n-1$\footnote{$n\ne N$ in general}, and a map $p':\{1\dots n-1\}\to \{0,1\}$ which all satisfy the respective properties of the theorem.  Let $$s:=\lst R_N\cdot \prod_{i=1\dots n-1, \,\,\left\{\lst R_N,P_{k'_i}^{[p(i)]}\right\}=0} \lst S'_i.$$  We know that $s$ commutes with every operator in $\lst S'$ because both $s$ and every operator in $\lst S'$ are equal to products of operators in $\lst R$, which all commute with each other.  Furthermore, since $s$ is a product of $\lst R_N$ and a factor of $\lst S'_i$ for every $i$ such that $\lst R_N$ and $P_{k'_i}^{[p'(i)]}$ anti-commute, and we know that $\lst S_i'$ is the only operator in $\lst S'$ that anti-commutes with $P_{k'_i}^{[p'(i)]}$ for $i=1\dots n-1$, it is therefore the case that $s$ commutes with every member of the set $\{P_{k'_i}^{[p'(i)]}\}_{i=1\dots n-1}$.  Finally, since $s$ is a product of $\lst R_N$ and operators in $\lst S'$, we can obtain $\lst R_N$ entirely from products of operators in $\{\lst S'_i\} \cup \{s\}$, and so $\genfun\paren{\{\lst S'_i\} \cup \{s\}}=\genfun\paren{\{\lst R_i\}}$.

If $s$ is the identity operator, then let $\lst S:=\lst S'$ and $p:=p$ and we are done.  Otherwise, we shall now show that there must exist integers $j\in\{1,\dots,N\}\backslash\{\lst k'_i\}$ and $l\in\{0,1\}$ such that $s$ anti-commutes with $P_{j}^{[l]}$, by demonstrating that if this were not the case then $s$ would have to anti-commute with some element in $\lst S'$, leading to a contradiction.

Assume that $s$ commutes with every operator in the set $\left\{P_j^{[l]}:\quad j\in\{1,\dots,N\}\backslash\{\lst k'_i\}, \quad l\in\{0,1\}\right\}.$  Recalling that $s$ is a member of the Pauli group and thus a tensor product of single-particle Pauli spin matrices, and also that $s$ commutes with every member of the set $\{P_{\lst k'_i}^{[p'(i)]}\}_{i=1\dots n-1}$, we see therefore that $s$ must be a product of elements from this set --- that is, there is some subset $\emptyset \ne \set F \subseteq \{P_{\lst k'_i}^{[p'(i)]}\}_{i=1\dots n-1}$ such that $s=\prod_{o\in \set F} o$.  However, from our inductive hypothesis we know that for every operator $f\in\set F$ there is an operator $s'\in\lst S'$ that anti-commutes with $f$ but commutes with the operators in $\set F\backslash\{f\}$.  Since $s$ is therefore a product of a single operator that anti-commutes with $s'$ and more operators that commute with $s'$, we conclude that $s$ and $s'$ anti-commute, which contradicts our earlier conclusion that $s$ commutes with every operator in $\lst S'$.

Now that we have shown that there exist integers $j\in\{1,\dots,N\}\backslash\{\lst k'_i\}$ and $l\in\{0,1\}$ such that $s$ anti-commutes with $P_{j}^{[l]}$, in terms of these integers we define
$$
\begin{aligned}
\lst S_i &:= 
\begin{cases}
\begin{cases}
\lst S'_i \cdot s & \{\lst S_i',P_j^{[l]}\}=0 \\
\lst S'_i & \text{otherwise}
\end{cases} & 1\le i\le n-1 \\
S' & i=n
\end{cases}, \\
\lst k_i &:=
\begin{cases}
\lst k'_i & 1 \le i \le n-1 \\
j & i=n
\end{cases},\quad \text{and} \\
p(i) &:=
\begin{cases}
p'(i) & 1 \le i \le n-1\\
l & i=n
\end{cases},
\end{aligned}
$$ and we are done.
\end{proof}
%@-node:gcross.20090519160701.4:Making them independent
%@+node:gcross.20090527164539.1:Construct the logical operators
\begin{remark}
Proposition \ref{make-independent-using-elimination} is good for more than computing an independent set of generators from a commuting list of operators;  it is also the key ingrediant in computing the logical qubit operators.
\end{remark}

\begin{proposition}
\label{construction-of-logicals}
Suppose that we have been given the objects described in 1-3 of Proposition \ref{make-independent-using-elimination}.  Let $\set S := \{\vec S_i\}_i.$  Then there exists a set of operators $\set L$ such that
\begin{enumerate}
\item \label{L-are-independent} the operators in $\set S\cup\set L$ are independent;
\item \label{L-are-conjugal-pairs} every operator in $\set L$ is a member of a conjugal pair with respect to $\set S\cup\set L$;
\item \label{L-completes-the-generators} $\genfun\paren{\set S\cup\set L}=\centralizer_\pauligroup(\set S)$ --- that is, the set generated by $\set S\cup\set L$ is equal to the set of Pauli operators that commute with $\set S$.
\end{enumerate}
\end{proposition}

\begin{proof}
Recalling that $n$ is the number of elements in $\lst S$ (and $\set S$), let $\lst l$ be some sequential ordering of $\{1 \dots N\}\backslash\{\vec k_i\}_i$, and then let $\set L:=\{\lst A_i\}_i\cup\{\lst B_i\}_i$ where
$$
\begin{aligned}
\lst A_i &:= P_{\lst l_i}^{[1]}\cdot \prod_{j=1\dots n\atop \{P_{l_i}^{[1]},\lst S_j\}=0} P_{\lst k_j}^{[s(j)]},\\
\lst B_i &:= P_{\lst l_i}^{[0]}\cdot \prod_{j=1\dots n\atop \{P_{l_i}^{[0]},\lst S_j\}=0} P_{\lst k_j}^{[s(j)]}.\\
\end{aligned}
$$

To see that property \ref{L-are-independent} is satisfied, observe the following.  First, the operators in $\set L$ are independent from the operators in $\set S$ since none of them is the identity operator and they all commute with every operator in $\{P_{\lst k_i}^{[s(i)]}\}_{i=1 \dots n}$.  Second, they are independent from each other since for every $i=1 \dots |\lst l|$ we have that $\vec A_i$ is the only operator that anti-commutes with $P_{\lst l_i}^{[0]}$ and $\lst B_i$ is the only operator that anti-commutes with $P_{\lst l_i}^{[1]}$.  Thus we conclude that all of the operators in $\set S\cup\set L$ are independent.

Next, to see that property \ref{L-are-conjugal-pairs} holds, observe that for every choice of operators $\lst A_i$ and $\lst S_j$ we have (by intentional construction) that $\lst S_j$ either anti-commutes with two of the operators in the product forming $\lst A_i$ or none at all, and so $[\lst S_i,\lst A_j]=0$ for all $i=1\dots n$ and $j=1\dots |\lst l|$;  by the same reasoning we see also that $[\lst S_i,\lst B_j]=0$ for all $i=1\dots n$ and $j=1\dots |\lst l|$.  Furthermore, each operator $\lst A_i$ commutes with every operator in $\set L$ except for its conjugal partner $\lst B_i$, since the only factor in $\lst A_i$ that could anti-commute with a factor contained within another operator in $\set L$ is $P_{l_i}^{[1]}$, and $\lst B_i$ is the only operator in $\set L$ that contains a factor $P_{l_i}^{[0]}$ that anti-commutes with $\lst X_{l_i}$;  reversing this argument, we also see that $\lst B_i$ commutes with every operator in $\set L$ except for $\lst A_i$.  Thus, every operator in $\set L$ is a member of a conjugal pair with respect to $\set L\cup\set S$.

Finally, to see that property \ref{L-completes-the-generators} holds, observe that since the operators in $\set S$ commute they can therefore be simultaneously diagonalized, which means that there is an automorphism on $\pauligroup$ that takes $\lst S_i\mapsto P_i^{[1]}$ for every $i=1 \dots n$.  The only operators that commute with every such $P_i^{[1]}$ are those which do not contain any factor of $P_i^{[0]}$ for $i=1 \dots n$, and so $\centralizer_\pauligroup\paren{\{P_i^{[0]}\}_{i=1\dots n}} = \genfun\paren{\{P_i^{[1]}\}_{i=1 \dots n}\cup \{P_i^{[l]}\}_{i=n+1 \dots N, \,\, l=0,1}}$, which has $2N-n$ generators.  Since the automorphism preserves the number of generators in the centralizer, we thus conclude that $\centralizer_\pauligroup(\set S)$ has exactly $2N-n$ generators.  Since $\set S\cup\set L$ contains independent operators which commute with every member of $\set S$, and furthermore $|\set S\cup\set L|=2N-n$, we thus conclude that $\genfun\paren{\set S\cup\set L}=\centralizer_\pauligroup(\set S)$.
\end{proof}
%@nonl
%@-node:gcross.20090527164539.1:Construct the logical operators
%@+node:gcross.20090520163423.15:Prove main theorem
With these building blocks in place, we now prove the main theorem:

\begin{proof}[Proof of Theorem \ref{theorem-SG}]
By Proposition \ref{proposition-SG}, we know that there exists a list of operators $\lst S$ and a set of independent operators $\set G$ satisfying the properties that are listed there.  By Proposition \ref{make-independent-using-elimination}, we know that there is an independent set of operators $\set S$ that generate the same subgroup as $\lst S$.  

Now let $\set F$ be a maximal subset of commuting operators in $\set G$ --- i.e., for each conjugal pair in $\set G$ take one of the two operators --- and then let $\set O := \set F \cup \set S$.  Since all of the operators in $\set O$ commute, we apply Proposition \ref{make-independent-using-elimination} again to conclude the existance of the objects listed there, and then we immediately apply Proposition \ref{construction-of-logicals} to show that a set $\set M$ exists with the properties listed there.  We are not done yet, however, since there might be operators in $\set G$ with which operators in $\set M$ anti-commute, so we let
$$\set L := \{m\cdot\prod_{f\in \set F\atop \{M,\text{conj}_{\set G}(f)\}=0} f :\quad m \in\set M\}$$
where $\text{conj}_{\set G}(F)$ is the conjugal partner of $F$ in the set $\set G$.  This guarantees that the operators in $\set L$ commute with every operator in $\set S\cup\set G$, and so we are done.
\end{proof}
%@-node:gcross.20090520163423.15:Prove main theorem
%@+node:gcross.20090511123440.5:Pseudo-code
\begin{remark}
A pseudo-code representation of the algorithm described by Theorem \ref{theorem-SG} is given in Table \ref{SG-algorithm}.
\end{remark}

\begin{table}
\label{SG-algorithm}
\begin{codebox}
\Procname{$\proc{Compute-Subsystem-Code}(\lst O)$}
\li $\lst S \gets []$
\li $\lst G\gets []$
\li \For $o \gets \lst O$ \label{li:csg-main-loop-start}
\li \Do
\li      \For $(g_X, g_Z) \gets \lst G$ %\Comment i.e., iterate over conjugal pairs in $\lst G$
\li      \Do
\li        \kw{if}  $\func{anti}(o,g_X)$ \kw{then} $o \gets o \cdot g_Z$
\li        \kw{if} $\func{anti}(o,g_Z)$ \kw{then} $o \gets o \cdot g_X$
          \End 
\li      \kw{if} \text{$o$ is identity} \kw{then} \Goto \ref{li:csg-main-loop-start}
\li      \For $s \gets \lst S$
\li      \Do
\li        \kw{if} $\func{anti}(o,s)$ \kw{then} \Goto \ref{li:make-into-gauge}
          \End
\li      \Goto \ref{li:csg-main-loop-start}
\li      $\lst G \gets \lst G \cup [(o,s)]$ \label{li:make-into-gauge}
\li      $i \gets 1$ 
\li      \For $s' \gets \lst S$ \label{li:kill-redundant-stabs}
\li      \Do
\li            \kw{if} $s'=s$ \kw{then} \Goto \ref{li:kill-redundant-stabs}
\li            \If $\func{anti}(s',o)$
\li            \Then
\li                  $\lst S[i] \gets s' \cdot s$
\li            \Else
\li                  $\lst S[i] \gets s$
                 \End
\li            $i \gets i+1$
             \End
\li        delete $\lst S[i\dots|\lst S|]$
      \End
\li $\lst I \gets []$
\li $\lst P \gets []$
\li \kw{call} $\proc{Gaussian-Elimination}(\lst S,1,\lst I,\lst P)$
\li $\lst T \gets \lst S \cup [g_X | (g_X,g_Z) \in \lst G]$
\li \kw{call} $\proc{Gaussian-Elimination}(\lst T,|\lst S|+1,\lst I,\lst P)$
\li $\lst L \gets []$
\li \For $i\gets 1\dots\,\,\text{number of physical qubits}$ \label{li:compute-logicals-loop}
\li \Do
\li     \kw{if} $i\in\lst I$ \kw{then} \Goto \ref{li:compute-logicals-loop}
\li     $l_X \gets X_i$
\li     $l_Z \gets Z_i$
\li     \For $(j,p,t)\gets (\lst I,\lst P,\lst T)$
\li     \Do
\li        \If $p=0$
\li        \Then
\li            \kw{if} $\func{anti}(t,X_j)$ \kw{then} $l_X \gets l_X \cdot Z_j$
\li            \kw{if} $\func{anti}(t,Z_j)$ \kw{then} $l_Z \gets l_Z \cdot Z_j$
\li        \Else
\li            \kw{if} $\func{anti}(t,X_j)$ \kw{then} $l_X \gets l_X \cdot X_j$
\li            \kw{if} $\func{anti}(t,Z_j)$ \kw{then} $l_Z \gets l_Z \cdot X_j$
             \End
          \End 
\li     \For $(g_X,g_Z)\in\lst G$
\li     \Do
\li         \kw{if} $\func{anti}(l_X,g_Z)$ \kw{then} $l_X \gets l_X \cdot g_X$
\li         \kw{if} $\func{anti}(l_Z,g_Z)$ \kw{then} $l_Z \gets l_Z \cdot g_X$
          \End
      \End
\li \Return $(\lst S,\lst G,\lst L)$
\end{codebox}
\caption{Algorithm which computes the subsystem code generated by a given list of measurement operators $\lst O$.}
\end{table}
%@-node:gcross.20090511123440.5:Pseudo-code
%@-node:gcross.20090423002455.3:Stabilizers and gauge qubits
%@+node:gcross.20090511123440.3:Optimal generators
\subsection{Optimal generators}

\label{optimal-generators}

%@+others
%@+node:gcross.20091221145013.1274:Lemma:  Recombining generators
In general there are multiple sets of operators that satisfy the properties of \ref{theorem-SG}, as is illustrated by the following Lemma:

\begin{lemma}
\label{combining-pairs}
Given conjugal pairs $Q:=(a,b)$ and $R:=(c,d)$ in relation to some set $\set X$, we have that
\begin{enumerate}
\item the pairs $Q':=(a\cdot c,b)$ and $R':=(c,d\cdot b)$ are conjugal pairs with respect to $\set X \backslash \{Q,R\} \cup \{Q',R'\}$; and
\item $\genfun\paren{\{a,b,c,d\}}=\genfun\paren{\{a\cdot c,b,c,d\cdot b\}}$.
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item Since $[a,c]=[a,d]=[b,c]=[b,d]=\{a,b\}=\{c,d\}=0$, we see therefore that $[a\cdot c,c]=[a\cdot c,d\cdot b]=[b,c]=[b,d\cdot b]=\{a\cdot c,b\}=\{c,d\cdot b\}=0$.  Furthermore, since $a$, $b$, $c$ and $d$ commute with every operator in $\set X\backslash \{Q,R\}$, so do $a\cdot c$ and $d\cdot b$.
\item Since $b$ and $c$ are Pauli operators and thus square to the identity, we have that $a\cdot c\cdot c=a$ and $d\cdot b\cdot b=d$, and so $\genfun\paren{\{a,b,c,d\}}=\genfun\paren{\{a\cdot c,b,c,d\cdot b\}}$.
\end{enumerate}
\end{proof}
%@-node:gcross.20091221145013.1274:Lemma:  Recombining generators
%@+node:gcross.20091221145013.1275:Definition: Undetectable error
As a result of this lemma, we see that we can take pairs of arbitrary conjugal pairs from sets $\set G$ and $\set L$ of Theorem \ref{theorem-SG} and replace them with different pairs per the recipe in Lemma \ref{combining-pairs} such that the properties of the theorem still hold.  So given that these sets are not unique, the natural question is:  What is the best choice of $\set G$ and $\set L$?  To answer this, we observe that another criteria we would like for our code to satisfy is that it be as robust to errors as possible;  in particular, we seek to maximize the difficulty of \emph{undetectable errors}, which is defined as follows:

\begin{definition}
Given a set $\set S\subseteq\pauligroup$ and operators $l\in\pauligroup$ and $e\in\centralizer_\pauligroup(\set S)$ which anti-commute (i.e., $\{l,e\}=0$), we say that $e$ is an \emph{undetectable error with respect to} $\set S$ \emph{acting on} $l$.
\end{definition}
%@nonl
%@-node:gcross.20091221145013.1275:Definition: Undetectable error
%@+node:gcross.20091221145013.1276:Definition: Weight
We assume that the `difficulty' of an interaction between our physical system and its environment is related to the number of physical qubits in our system that are participating in the interaction.  Thus, the natural metric for measuring the relative difficulty of an error is given by its weight, which recall is defined as follows:

\begin{definition}
Given an operator $p\in\pauligroup$---which recalls means that $p$ is the tensor product of single-qubit Pauli unnormalized spin matrices---the \emph{weight} of $p$ is the number of single-qubit operators in the product which are non-trivial (i.e., not the identity).  So for example, the weight of $I\otimes I\otimes I$ is 0, the weight of $I\otimes Z\otimes I\otimes X$ is 2, and the weight of $Z\otimes X\otimes Y$ is 3.
\end{definition}
%@nonl
%@-node:gcross.20091221145013.1276:Definition: Weight
%@+node:gcross.20091221145013.1277:Definition: Additional notation
For convenience, we introduce the following additional notation:

\begin{definition}
$\quad$

\begin{itemize}
\item assuming we have a set of independent operators, $\set Q$, the function $\set G_{\set Q}:\genfun(\set Q)\to\powerset(\set Q)$ is defined (uniquely) such that for every $q\in\set Q$ we have that $q=\prod_{o\in\set G_{\set Q}(q)} o$;
\item the function $w:\pauligroup\to \mathscr{N}$ is defined such that $w(o)$ gives the weight of $o$;
\item the function $e_{\set S}:\centralizer_\pauligroup\paren{\set S}\to \paren{\powerset\circ\centralizer_\pauligroup}\paren{\set S}$ is defined such that $\set e_{\set S}(l)$ is the set of minimizers of $w$ over the set $\left\{o: o\in \centralizer_\pauligroup\paren{\set S}, \{o,l\}=0\right\}$ --- that is, it gives the undetectable errors with respect to $\set S$ acting on $l$ that are of minimum weight;
\item the function $\om_{\set S}:\centralizer_\pauligroup\paren{\set S}\to\mathscr{N}$ is defined such that $\om_{\set S}:=w(o)$ for an arbitrarily chosen $o\in\circ \set e_{\set S}$ --- note that function is well-defiend since all operators in the set $\set e_{\set S}$ have the same weight;
\item the function $m_{\set S}:\centralizer_\pauligroup\paren{\set S}\times \centralizer_\pauligroup\paren{\set S} \to \mathscr{N}$ is defined such that $m_{\set S}(l,l'):=\min \{\om_{\set S}(l),\om_{\set S}(l')\}$ --- that is, it gives the smaller of the weights of the smallest weight errors acting on respectively $\set L$ and $\set L'$;
\item the function $\vec M^{(N)}_{\set S}$ is defined such that $\vec M^{(N)}_{\set S}\paren{\vec P}$ is the sequence of $N$ integers such that $\vec M^{(N)}_{\set S}\paren{\vec P}_i := m_{\set S}\paren{\vec P_i}$;
\item the functions $p_1$ and $p_2$ are defined such that, given $(a,b):=x$, we have that $p_1(x):=a$ and $p_2(x):=b$.
\item the function $\set U:\powerset(\pauligroup\times\pauligroup)\to\powerset(\pauligroup)$ is defined (for convenience) such that $\set U\paren{\set X}:=\bigcup_{x\in\set X} \{p_1(x),p_2(x)\}$ --- that is, it `unpacks' a set of pairs of operators into a set of operators;  in an abuse of notation, we shall also allow $\set U$ to apply to sequences, so that $\set U(\lst P) := \set U\paren{\{\lst P_i\}_i}$, and to individual pairs, so that if $X$ is a single pair then $\set U(X) := \set U(\{X\})$;
\item finally, a \emph{choice of $N$ qubits stabilized by $\set S$}, $\lst P$, is a sequence of $N$ pairs of operators from the Pauli group such that 
\begin{enumerate}
\item $\set U(\lst P)\cap \set S = \emptyset$ --- that is, the operators in $\lst P$ are not included in $\set S$;
\item every pair in $\lst P$ is a conjugal pair with respect $\set S \cup \set U(\lst P)$;
\item $(\om_{\set S}\circ p_1)(\lst P_i)=m_{\set S}(\lst P_i)$; and
\item $\lst M^{(N)}(\lst P)$ is an ordered sequence.
\end{enumerate}
\end{itemize}

\end{definition}
%@nonl
%@-node:gcross.20091221145013.1277:Definition: Additional notation
%@+node:gcross.20091221145013.1278:Definition: Total ordering => Optimal choice of qubits
Given the notation above, we now precisely define what we mean by the ``best choice'' of logical qubits.

\begin{definition}
An \emph{optimal choice of $N$ qubits stabilized by $\set S$} is any choice of $N$ qubits, $\lst P$ stabilized by $\set S$, such that given any other choice of $N$ qubits, $\lst P'$, that is also stabilized by $\set S$, such that $(\genfun\circ \set U)(\lst P)=(\genfun\circ \set U)(\lst P')$, we have that $\lst M^{(N)}(\lst P)_i \ge \lst M^{(N)}(\lst P')_i$ for all $1\le i \le N$.
\end{definition}
%@-node:gcross.20091221145013.1278:Definition: Total ordering => Optimal choice of qubits
%@+node:gcross.20100125183648.1308:Theorem: Optimality condition
%@+node:gcross.20100125183648.1309:Statement
How do we know that a choice of qubits is optimal?  It turns out that there is a very simple condition that is sufficient for demonstrating this.

\begin{theorem}
\label{optimality-condition}
If $\lst P$ is a choice of $N$ logical qubits stabilized by $\set S$ such that for every subset $\set O\subset\set U(\lst P)$ satisfying the property that $\om_{\set S}(o)<m_{\set S}(\lst P_N)$ for every $o$ in $\set O$, we have that $\om_{\set S}\paren{\prod_{\set O} o}\le \text{max}_{\set O}\,\, \om_{\set S}(o)$, then $\lst P$ is an optimal choice of qubits.
\end{theorem}

Before we can prove this Theorem, we need a couple of Lemmas and a Proposition.
%@-node:gcross.20100125183648.1309:Statement
%@+node:gcross.20100125183648.1306:Lemma: Combinations can't make things worse
\begin{lemma}
\label{combinations-can't-make-things-worse}
For any set of operators $\set O$, we have that $\om_{\set S}\paren{\prod_{o\in\set O} o} \ge \text{min}_{o\in \set O}\,\om_{\set S}\paren{o}$.
\end{lemma}

\begin{proof}[Proof of Lemma]
Any undetectable error with respect to $\set S$ acting on $\om_{\set S}\paren{\prod_{o\in\set O} o}$ must also act at least one of the operators in $\set O$ since otherwise it cannot anti-commute with the product. \end{proof}
%@-node:gcross.20100125183648.1306:Lemma: Combinations can't make things worse
%@+node:gcross.20100125183648.1304:Lemma: The lesser operator wins
\begin{lemma}
\label{lesser-operator-wins}
Suppose we are given two operators $a,b\in\pauligroup$ such that $\om_{\set S}(a)<\om_{\set S}(b)$;  then $\om_{\set S}(a\cdot b) = \om_{\set S}(a)$.
\end{lemma}

\begin{proof}[Proof of Lemma]
Since $\om_{\set S}(a)<\om_{\set S}(b)$, there must be an undetectable error with respect to $\set S$ that acts on $a$ but not on $b$;  thus, it must anti-commute with and hence act on the product $a\cdot b$, so that $\om_{\set S}(a\cdot b)\le \om_{\set S}(a)$.  Since $\om_{\set S}(a\cdot b)\ge \om_{\set S}(a)$ by Lemma , we conclude that $\om_{\set S}(a\cdot b) = \om_{\set S}(a)$.
\end{proof}
%@nonl
%@-node:gcross.20100125183648.1304:Lemma: The lesser operator wins
%@+node:gcross.20100125183648.1319:Proposition: Bound on recombinations
%@+node:gcross.20100125183648.1320:Statement
\begin{proposition}
\label{bound-on-recombinations}
Suppose we are given
\begin{enumerate}
\item sets of Pauli operators $\set Q$ and $\set S$;
\item a non-empty set of conjugal pairs, $\set C$, with respect to $\set U(\set C) \cup \set S$, such that $U(\set C)\subseteq \genfun(\set Q)$; and \item a set $\set A$ with the property that for any conjugal pair $X:=(a,b)$ such that $\{a,b\}\subseteq(\genfun\circ\set U)(\set C)$, we must have that $\set G_{\set Q}(X) \cap \set A \ne \emptyset$.
\end{enumerate}
Then $|\set C|\le|\set A|$.
\end{proposition}

In order to prove this Proposition, we will first need some additional Lemmas.
%@-node:gcross.20100125183648.1320:Statement
%@+node:gcross.20100125183648.1321:Single pair rearrangement.
\begin{lemma}
\label{single-pair-rearrangement}
Let $A:=(a,b)$ with $\{a,b\}\subseteq\genfun(\set Q)$ be a conjugal pair with respect to some set $\set S$, and $o$ be some Pauli operator such that $o\in\set G_{\set Q}(A)$.  Then there exists a pair $B:=(c,d)$ such that
\begin{enumerate}
\item $\{c,d\}\subseteq\genfun(\set Q)$;
\item $o\in \set G_{\set Q}(c)$;
\item $o\notin \set G_{\set Q}(d)$;
\item $(c,d)$ is a conjugal pair with respect to $\paren{\set S\backslash \{a,b\}}\cup\{c,d\}$; and
\item $(\genfun\circ\set U)(B) = (\genfun\circ\set U)(A)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let
$$
(c,d):=
\begin{cases}
\paren{a,b} & o\in \set G_{\set Q}(a), o\notin \set G_{\set Q}(b) \\
\paren{b,a} &  o\notin \set G_{\set Q}(a), o\in \set G_{\set Q}(b) \\
\paren{a,b\cdot a} & o\in \set G_{\set Q}(a), o\in \set G_{\set Q}(b) \\
\end{cases}
$$
Note that in any of the above cases, properties 1-3 are satisfied by construction, property 4 is satisfied because $c$ and $d$ are products of $a$ and $b$ which commute with every element in $\set S\backslash \{a,b\}$ and $\{c,d\}=0$, and finally property 5 is satisfied because $\{a,b\}\subseteq \genfun\paren{\{c,d\}}$ and $\{c,d\}\subseteq \genfun\paren{\{a,b\}}$.
\end{proof}
%@nonl
%@-node:gcross.20100125183648.1321:Single pair rearrangement.
%@+node:gcross.20100125183648.1322:Directed Gaussian elimination
\begin{lemma}
\label{directed-gaussian-elimination-of-logicals}
In the context of Proposition \ref{bound-on-recombinations}, suppose we are given an element $a\in \set A$ with the property that there exists a pair $Y''\in\set C$ such that $a\in\set G(Y'')$. Then there exists a conjugal pair $Y$ and set of conjugal pairs $\set D$, all with respect to $\set U\paren{\{Y\}\cup \set D} \cup \set S$, such that
\begin{enumerate}
\item $|\set D| = |\set C|-1$
\item $(\genfun\circ\set U)(\{Y\}\cup \set D)=(\genfun\circ\set U)(\set C)$;
\item $a\in (\set G_{\set Q}\circ p_1)(Y)$ but $a\notin (\set G_{\set Q}\circ p_2)(Y)$;
\item $a\notin \bigcup_{D\in \set D} \set G_{\set Q}(D)$; and
\item for every conjugal pair $O\in\set D$, we have that $\set G_{\set Q}(O) \cap \set A\backslash \{a\} \ne \emptyset$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof by induction on the size of $\set C$.  If $\set C=\{Y''\}$, then apply Lemma \ref{single-pair-rearrangement} letting $o:=a$, $A:=Y''$, and $Y:=B$, and we see that we have a pair $Y$ which is conjugal with respect to $\{Y\}\cup\set S$ and also such that $(\genfun\circ\set U)(\{Y\})=(\genfun\circ\set U)(\{Y''\})$.  Let $\set D:=\emptyset$, and we see that the remaining properties hold trivially, so we are done.

Now let us assume that this lemma has been proven for the case where $|\set C|=n-1$, and we are given a set $\set C$ with $n$ elements.  Take any $X''\in\set C\backslash\{Y''\}$, and apply the lemma to $\set C\backslash \{X''\}$, $\set A$, $a$ and $Y''$ to obtain the objects $Y'$ and $\set D'$ described in this Lemma without the primes.  If $a\notin\set G(X'')$, then by the assumptions of the Lemma we know that $\set G(X'') \cap \set A\backslash \{a\} \ne \emptyset$, so let $Y:=Y'$ and $\set D:=\set D'\cup\{X''\}$, and we are done.

Otherwise, apply Lemma \ref{single-pair-rearrangement}, setting $A:=X''$, $o:=a$, and $X':=B$, and let $X:=\paren{p_1(X')\cdot p_1(Y'),p_2(X')}$ and $Y:=\paren{p_1(Y'),p_2(Y')\cdot p_2(X')}$.  Note $X'$ and $Y'$ are conjugal pairs with respect to $\set U\paren{\{X',Y'\}\cup\set D}\cup\set S$ and $\{X',Y'\}\cap \paren{\set D\cup\set S}=\emptyset$, and so by Lemma \ref{combining-pairs} we conclude that $X$ and $Y$ are conjugal pairs with respect to $\set U\paren{\{X,Y\}\cup\set D}\cup\set S$, and also that $(\genfun\circ\set U)(\{X,Y\})=(\genfun\circ\set U)(\{X',Y'\})$;  since $X'$ was obtained from applying Lemma \ref{single-pair-rearrangement} to $X''$ and $a$, we furthermore conclude that $(\genfun\circ\set U)(\{X,Y\})=(\genfun\circ\set U)(\{X'',Y'\})$.  Since $X'$ was obtained as a result of Lemma \ref{single-pair-rearrangement}, we know that $a\in (\set G \circ p_1)(X')$ but $a\notin (\set G_{\set Q} \circ p_2)(X')$, and we also know from the earlier recursive application of this Lemma that $a\in (\set G \circ p_1)(Y')$ but $a\notin (\set G_{\set Q} \circ p_2)(Y')$.  Thus, we observe that by construction, $a\in (\set G_{\set Q} \circ p_1)(Y)$, and $a\notin \paren{(\set G_{\set Q} \circ p_2)(Y) \cup \set G_{\set Q}(X)}$.

Let $\set D:=\{X\}\cup\set D'$, and observe that $|\set D|=|\set D'|+1=|\set C\backslash \{X''\}|-1+1=|\set C|-1$, and also that $(\genfun\circ\set U)(\{Y\}\cup\set D)=(\genfun\circ\set U)(\{X,Y\}\cup\set D')=(\genfun\circ\set U)(\{X''\}\cup(\{Y'\}\cup\set D'))=(\genfun\circ\set U)(\{X''\}\cup(\set C'\backslash\{X''\}))=(\genfun\circ\set U)(\set C)$.  Furthermore, by the earlier recursive application of this Lemma we know that $a\notin\set G_{\set Q}(O)$ for every $O\in \set D'$, so since we have also established that $a\notin \set G_{\set Q}(X)$, we conclude that $a\notin\set G_{\set Q}(O)$ for every $O\in \set D$;  since also know that every such $O$ must also satisfy $\set G_{\set Q}(O)\cap \set A \ne \emptyset$, we conclude that every such $O$ satisfies $\set G_{\set Q}(O) \cap A\backslash\{a\}\ne\emptyset$.
\end{proof}
%@-node:gcross.20100125183648.1322:Directed Gaussian elimination
%@+node:gcross.20100125183648.1323:Undirected Gaussian elimination
\begin{lemma}
\label{undirected-gaussian-elimination-of-logicals}
In the context of Proposition \ref{bound-on-recombinations}, there exists a Pauli operator $a$ satisfying the assumption of Lemma \ref{directed-gaussian-elimination-of-logicals}.
\end{lemma}

\begin{proof}
Take any pair $Y'\in\set C$.  By the assumptions of Proposition \ref{bound-on-recombinations}, we know that $\set G(Y')\cap \set A \ne \emptyset$, which implies that there exists an element $a\in A$ such that either $a\in (\set G_{\set Q}\circ p_1)(Y')$ or $a\in (\set G_{\set Q}\circ p_2)(Y')$.  The existance of $Y$ and $\set D$ then follow immediately from the application of Lemma \ref{directed-gaussian-elimination-of-logicals}.
\end{proof}
%@nonl
%@-node:gcross.20100125183648.1323:Undirected Gaussian elimination
%@+node:gcross.20100125183648.1324:Elimination to create subset
\begin{lemma}
\label{elimination-to-create-subset}
In the context of Proposition \ref{bound-on-recombinations}, there exists a set of conjugal pairs, $\set X$, with respect to $\set X\cup\set S$, and a subset of operators, $\set O\subseteq \set A$, such that
\begin{enumerate}
\item $|\set X|=|\set O|=|\set C|$;
\item $(\genfun\circ\set U)(\set X)=(\genfun\circ\set U)(\set C)$; and
\item for every $o\in\set O$, there is a conjugal pair $Y\in\set X$ such that $o\in\set G_{\set Q}(Y)$;
\end{enumerate}
\end{lemma}

\begin{proof}
Proof by induction.  If $\set C$ is empty, then the empty sets trivially satisfy this Lemma.

Now suppose that we have proven this Lemma for $|\set C|=N-1$, and assume we have been given sets $\set C$ and $\set A$ such that $|\set C|=N$.  Applying Lemma \ref{undirected-gaussian-elimination-of-logicals} to $\set C$ and $\set A$ we obtain the conjugal pair $Y$,  the set of conjugal pairs $\set D$, and the element $a$ described in the conclusions of that Lemma.  Apply this Lemma recursively to the respective sets $\set D$ and $\set A\backslash\{a\}$, we obtain the sets $\set X'$ and $\set O'$ described (without the primes) in this Lemma; let $\set X := \set X'\cup\{Y\}$ and $\set O:=\set O'\cup\{a\}$.  Note that $\set X$ is a set of conjugal pairs with respect to $\set X\cup\set S$ since $\set X'$ is a set of conjugal pairs with respect to $\set X'\cup\set S$, and we know that the operators in $Y$ commute with every operator in every pair in $\set X'$ since they commute with every operator in $(\genfun\circ\set U)(\set D)=(\genfun\circ\set U)(\set X')$.

First, observe that $|\set O|=|\set O'|+1$ since $a\notin \set O'$.  Futhermore, $a\notin \bigcup_{x\in \set U(\set X')} \set G(x)$ since $a\notin \bigcup_{x\in \set U(\set D)} \set G_{\set Q}(x)$ by Lemma \ref{undirected-gaussian-elimination-of-logicals} and $(\genfun\circ\set U)(\set D)=(\genfun\circ\set U)(\set X')$ by recursive application of this Corolary.  Thus, $|\set X|=|\set X'|+1$ since $Y\notin X'$ as $a\in\set G(Y)$, and $|\set X|=|\set O|=|\set D|+1=|\set C|-1+1=|\set C|$.

Second, observe that since $(\genfun\circ\set U)(\set X')=(\genfun\circ\set U)(\set D)=(\genfun\circ\set U)(\set C)$ by recursive application of this Lemma and $(\genfun\circ\set U)(\{Y\}\cup\set D)=(\genfun\circ\set U)(\set C)$ by Lemma \ref{undirected-gaussian-elimination-of-logicals}, we conclude that $(\genfun\circ\set U)(\set X) = (\genfun\circ\set U)(\{Y\}\cup\set X') = (\genfun\circ\set U)(\{Y\}\cup\set D) = (\genfun\circ\set U)(\set C)$.

Finally, observe that for every $o\in\set O$ we either have that $o=a$, in which case $Y\in\set X$ and $o\in\set G_{\set Q}(Y)$, or $o\in \set A\backslash\{a\}$, in which case by recursive application of this Lemma we know that there is an operator $Z\in \set X'\subseteq \set X$ such that $o\in\set G_{\set Q}(Z)$.
\end{proof}
%@nonl
%@-node:gcross.20100125183648.1324:Elimination to create subset
%@+node:gcross.20100125183648.1325:Proof
With these Lemmas having performed the heavy lifting, the Proof of Proposition {bound-on-recombinations} is quite simple.

\begin{proof}[Proof of Proposition \ref{bound-on-recombinations}]
Proof by contradiction.  By Lemma \ref{elimination-to-create-subset}, there would have to exist a subset $\set O\subseteq\set A$ such that $|\set C|=|\set O|>|\set A|$, which is impossible.
\end{proof}
%@-node:gcross.20100125183648.1325:Proof
%@-node:gcross.20100125183648.1319:Proposition: Bound on recombinations
%@+node:gcross.20100125183648.1326:Proof
We now have all of the tools that we need to prove Theorem \ref{optimality-condition}.

\begin{proof}[Proof of Theorem \ref{optimality-condition}]
Proof by contradiction.  Let $\lst P'$ be some choice of qubits stabilized by $\set S$ such that $(\genfun\circ\set U)(\lst P)=(\genfun\circ\set U)(\lst P')$ and there exists some integer $k$ such that $M^{(N)}_{\set S}(\lst P')_k > M^{(N)}_{\set S}(\lst P)_k$;  in particular, let $k$ be the smallest such integer, and let $\set C:=\{\lst P'_i : i \ge k\}$.  Let $l$ be the smallest integer such that $M^{(N)}_{\set S}(\lst E_l)\ge M^{(N)}_{\set S}(\lst P')_k$ or $N+1$ if there is no such integer, and $\set A := \{p_1(\lst P_i) : i \ge l\}$; note that since $M^{(N)}(\lst P')_k > M^{(N)}(\lst P)_k$ we must have $l>k$, and hence $|\set C| > |\set A|$.

Take any pair $(a,b)\in\set C$.  Let $\set X:=\{x : x\in \set G_{\set U(\lst P)}(a),\,\, \om_{\set S}(x) < \om_{\set S}(a)\}$, $\set Y:=\set G_{\set U(\lst P)}(a)\backslash \set X$, $x := \prod_{o\in\set X} o$ and $y := \prod_{o\in\set Y} o$;  note that by construction we have that $a=x\cdot y$.  Now, if $\set X$ were non-empty, then $\om_{\set S}(x) \le \max_{o\in \set X} \om_{\set S}(o) < \om_{\set S}(a)$ by the assumptions of this Theorem, and so we would conclude that $\om_{\set S}(x\cdot y) = \om_{\set S}(x) < \om_{\set S}(a)$ since either $y$ is the identity or $\om_{\set S}(x)<\om_{\set S}(a)\le \om_{\set S}(y)$ by construction and so we reach the same conclusion from Lemma \ref{lesser-operator-wins}.  Thus, we see that $\set X$ must be empty since otherwise we would have that $\om_{\set S}(a)=\om_{\set S}(x\cdot y)<\om_{\set S}(a)$, which is nonsense, and so we conclude that $\om_{\set S}(o)\ge \om_{\set S}(a)$ for every $o\in\set G_{\set U(\lst P)}(a)$; using the same reasoning process we likewise conclude that $\om_{\set S}(o)\ge \om_{\set S}(b)\ge \om_{\set S}(a)$ for every $o\in\set G_{\set U(\lst P)}(b)$.  (Recall that the condition $\om_{\set S}(b)\ge \om_{\set S}(a)$ comes from the definition of a choice of qubits.)

Since $a$ and $b$ anti-commute, it must be the case that there is an integer $i$ such that $o:=p_1(\lst P)\in \set G_{\set U(\lst P)}(O)$, because if every operator in $\set G_{\set U(\lst P)}(O)$ were the second member of a pair in $\lst P$ then $a$ and $b$ would commute.  Furthermore, we know that $i\ge l$ since otherwise $\om_{\set S}(o) < \om_{\set S}(a)$, which would contradict the conclusion of the previous paragraph;  thus, we conclude that $o\in \set A$.

We have now demonstrated that for every pair $O\in\set C$, we must have $\set G(O)\cup\set A \ne\emptyset$.  Observe that this means that sets $\set C$ and $\set A$ match the descriptions in Proposition \ref{bound-on-recombinations}, and thus we see that it is impossible for $|\set C|>|\set A|$, and so we have a contradiction.  We thus conclude that no such choice $\lst P'$ can exist.
\end{proof}
%@-node:gcross.20100125183648.1326:Proof
%@-node:gcross.20100125183648.1308:Theorem: Optimality condition
%@+node:gcross.20100126164527.1285:Corolary: Alternative optimality condition
%@-node:gcross.20100126164527.1285:Corolary: Alternative optimality condition
%@+node:gcross.20100126164527.1288:Lemma: Multiple recombinations
\begin{lemma}
\label{multiple-recombinations}
Suppose we are given a pair $(a,b)$ and a seqence of $N$ pairs $\lst Q$ all conjugal to some set $\set S$, and two sequences of elements from $\{0,1\}$, $\lst f^{(1)}$ and $\lst f^{(2)}$.  Define
$$b':=b\cdot\prod_{1 \le i \le N, k \in \{0,1\}, f^{(k)}_i=1}p_{(3-k)}(\lst Q_i),$$
$\lst O'_i := (o'^{(1)}_i,o'^{(2)}_i)$ where
$$o'^{(k)}_i :=
\begin{cases}
p_k(\lst O_i) & l^{(k)}_i = 0\\
p_k(\lst O_i) \cdot a & l^{(k)}_i = 1,
\end{cases}
$$
and
$$\set S' := \left[\set S\backslash\paren{\{a,b\} \cup \set U(\lst Q)}\right]\cup \{a,b'\} \cup \set U(\lst Q').$$
Then
\begin{enumerate}
\item the pair $(a,b')$ and the sequence of pairs $\lst Q'$ are all conjugal pairs with respect to $\set S'$; and
\item $\genfun\paren{\{a,b'\}\cup \set U(\lst Q')}=\genfun\paren{\{a,b\}\cup \set U(\lst Q)}$
\end{enumerate}
\end{lemma}

\begin{proof}
Proof by induction.  For the base case, note that statement trivially holds for $N=0$.

Now suppose we have proven this for all sequences of $N-1$ pairs, and we are given a sequence of $N$ pairs.  Invoking the inductive hypothesis, apply this Lemma recursively to the first $N-1$ elements of $\lst Q$ and $\lst f$, and let $b''$, $\lst Q''$ and $\set S''$ refer to the objects described in this Lemma (without the extra primes) as applied to these $N-1$ elements.

Let
$$
c := 
\begin{cases}
b'' & l^{(1)}_N = 0\\
b'' \cdot p_2(\lst Q_N)  &  l^{(1)}_N = 1,\\
\end{cases}
\quad
d_1 :=
\begin{cases}
p_1(\lst Q_N) & l^{(1)}_N = 0\\
p_1(\lst Q_N) \cdot a &  l^{(1)}_N = 1,\\
\end{cases}
$$
and
$$\set R := \left[\set S''\backslash\{a,b'',p_1(\lst Q_N),p_2(\lst Q_N)\}\right]\cup \{a,c,d_1,p_2(\lst Q_N)\}.$$
Note that for either value of $f^{(1)}$ we have that the pairs $(a,c)$ and $(d_1,p_2(\lst Q_N))$ are conjugal with respect to $\set R$ and that $\genfun\paren{\{a,c,d_1,p_2(\lst Q_N)\}}=\genfun\paren{\{a,b'',p_1(\lst Q_N),p_2(\lst Q_N)\}}$; for $f^{(1)}=0$ this conclusion is trivial since $b''=c$ and $d_1=p_1(\lst Q_N)$, and for $f^{(1)}=1$ we obtain this conclusion by applying Lemma \ref{combining-pairs}.

Now let
$$
c' := 
\begin{cases}
c & l^{(2)}_N = 0\\
c \cdot d_1  &  f^{(2)}_N = 1,\\
\end{cases}
\quad
d_2 :=
\begin{cases}
p_2(\lst Q_N) & f^{(2)}_N = 0\\
p_2(\lst Q_N) \cdot a &  f^{(2)}_N = 1,\\
\end{cases}
$$
and
$$\set R' := \left[\set R\backslash\{a,c,d_1,p_2(\lst P_N)\}\right]\cup \{a,c',d_1,d_2\}.$$
Applying the same reasoning as before, we conclude that the pairs $(a,c')$ and $(d_1,d_2)$ are conjugal with respect to $\set R'$ and that $\genfun\paren{\{a,c',d_1,d_2\}}=\genfun\paren{\{a,c,d_1,p_2(\lst P_N)\}}$.

Finally, let
$$c'' :=
\begin{cases}
c' \cdot a & f^{(1)}_N = 1 \,\,\text{and}\,\, f^{(2)}_N = 1 \\
c' & \text{otherwise},\\
\end{cases}
$$
and
$$
\set R'':=
\left[\set R'\backslash\{a,c'\}\right]\cup \{a,c''\}.
$$
Observe that $\{a,c''\}=0$ and that $a$ and $c''$ are products of $a$ and $c$;  thus, $\genfun\paren{\{a,c'',d_1,d_2\}}=\genfun\paren{\{a,c',d_1,d_2\}}$, and furthermore $a$ and $c''$ commute with every operator in $\set R''$ save each other and so $\{(a,c'')\} \cup \{(d_1,d_2\}$ are conjugal pairs with respect to $\set R''$.

Note, however, that by construction we have that $b'=c''$, $\set S'=\set R''$, and
$$\lst Q'_i :=
\begin{cases}
\lst Q''_i & i < N \\
(d_1,d_2) & i = N.\\
\end{cases}
$$
Thus, we are done.
\end{proof}
%@-node:gcross.20100126164527.1288:Lemma: Multiple recombinations
%@+node:gcross.20100127132544.1287:Corolary: Recombination to make commute
\begin{corolary}
\label{recombination-to-make-commute}
Suppose a pair $(a,b)$ and a set of pairs $\set R$ all conjugal to some set $\set S$, and a Pauli operator $x$ such that $\{a,x\}=0$.  Let $b' := b\cdot \prod_{X\in\set R, \{p_k(X),a\}=0} p_{(3-k)}(X)$, $\set R':=\{\paren{f(c),f(d)}: (c,d)\in\set R\}$ where
$$
f(o) :=
\begin{cases}
o & [o,x]=0 \\
o\cdot a & \{o,x\}=0, \\
\end{cases}
$$
and
$$\set S' := \left[\set S\backslash\paren{\{a,b\} \cup \set U(\set R)}\right]\cup \{a,b'\} \cup \set U(\set R').$$
Then
\begin{enumerate}
\item the pair $(a,b')$ and the set of pairs $\set R'$ are all conjugal pairs with respect to $\set S'$;
\item $\genfun\paren{\{a,b'\}\cup \set U(\set R')}=\genfun\paren{\{a,b\}\cup \set U(\set R)}$;
\item $x$ commutes with every operator in $\set R'$;
\item and $\min_{r'\in \set U(\set R')}\om_{\set S}(r')\ge \min\paren{\om_{\set S}(a),\min_{r\in \set U(\set R)}\om_{\set S}(r)}$;
\end{enumerate}
\end{corolary}

\begin{proof}
Place any arbitrary ordering in $\set R$, and the define then sequences $f^{(1)}$ and $f^{(2)}$ such that
$$\lst f^{(j)}_i :=
\begin{cases}
0 & [p_j(\lst R_i),x] = 0 \\
1 & \{p_j(\lst R_i),x\} = 0. \\
\end{cases}
$$
The first two conclusions of this Corolary follows immediately from Lemma \ref{multiple-recombinations}, dropping the ordering on $\lst R'$.  The third comes from the fact that every element in $\set R'$ is either an element from $\set R$ that commutes with $x$ or the product of $a$ with an element from $\set R$ that anti-commutes with $x$, which must also commute with $x$.  The fourth comes directly from Lemma \ref{combinations-can't-make-things-worse}.
\end{proof}
%@-node:gcross.20100127132544.1287:Corolary: Recombination to make commute
%@+node:gcross.20100126164527.1286:Proposition: Creation of certificate
\begin{comment}

\begin{proposition}
Suppose we are given a set of $N$ pairs $\set L$ and a set of Pauli operators $\set S$ such that every pair in $\set L$ is conjugal with respect to $\set U(\set L)\cup\set S$.  Then for every $0\le k \le 2N$, there exist
\begin{itemize}
\item a choice of qubits $\lst P$ stabilized by $\set S$;
\item a set of qubits, $\set Q$;
\item and a sequence of $n$ sequences $\lst O^{(l)}$ of Pauli operators;
\end{itemize}
such that, letting $\set X:=\set U(\set Q) \cup \paren{\set U(\lst P) \backslash \bigcup_l \set U(\lst O^{(l)})}$, we have that
\begin{enumerate}
% 1
\item \label{pairs are all conjugal to R} the pairs in $\lst P$ and $\set Q$ are all conjugal with respect to $\set R := \set U(\lst P)\cup \set U(\set Q)\cup \set S$;
% 2
\item $\genfun\paren{\set U(\lst P)\cup \set U(\set Q)}=(\genfun\circ\set U)(\set L)$;
% 3
\item \label{nothing smaller in Q} if $\lst P$ is non-empty, then $n \ge m_{\set S}(\lst P_{|\lst P|})$ and $\om_{\set S}(o)\ge m_{\set S}(\lst P_{|\lst P|})$ for all $o\in\set X$;
% 4
\item $\left|\{\lst O^{(l)}_i\}_{l,i}\right| = k$;
% 5
\item \label{certificate is subset of the choice of qubits} $\{\lst O^{(l)}_i\}_{l,i}\subseteq \set U(\lst P)$
% 6
\item \label{all first pairs are present in the certificate} for every $1 \le i \le |\lst P|$ there exists integers $j$ and $l$ such that $p_1(\lst P'_i)=\lst O^{(l)}_j$.
% 7
\item \label{O has the certificate property} $\{\lst O^{(l)}_i\}_i=\{o:o\in\set U(\lst P), \om_{\set S}(o)=l\}$ for $l<m_{\set S}(\lst P_{|\lst P|})$;
% 8
\item \label{O has the certificate property, extending to X} and for every $1\le l\le n$ and $1 \le j \le |\lst O^{(l)}|$ there exists an undetectable error (with respect to $\set S$) of weight $l$ that acts on $\lst O^{(l)}_j$ but not on any operator in $\{\lst O^{(l)}_i : i > j\}\cup\set U(\set Q)$;  furthermore, if $\lst O^{(l)}$ is the first member of a pair in $\lst P$, then this same error acts on no operator in $\set X$.
\end{enumerate}
\end{proposition}

\begin{proof}
Proof by induction.  For the base case, let $n=0$ and $\lst P'$ be the empty sequence;  then the conclusions are satisfied vacuously.

Now assume that this Proposition has been proven for some integer $k-1$;  let $\lst P'$, $\lst Q'$, $n'$, $\lst O^{(l)'}$ and $\set X'$ be the named objects (without the primes) obtained by recursively applying this Proposition to the integer $k-1$  Let $x$ be the minimizer of $w$ over the set $\bigcup_{o\in\set X'} \set e_{\set S}(o)$, let $o\in\set X'$ be some arbitrarily chose operator such that $x\in \set e_{\set S}(o)$, and let  $d:=\om_{\set S}(o)$;  note that by the inductive hypthosis we know from property \ref{nothing smaller in Q} that $d\ge n$.

There are two cases;  either
\begin{enumerate}
\item $o\in \set U(\lst P)$;
\item or $o\notin \set U(\lst P)$ and $o\in\set U(\set Q)$.
\end{enumerate}

\begin{description}

\item[Case 1 $\Rightarrow o\in\set U(\lst P)$]
By properties \ref{certificate is subset of the choice of qubits} and \ref{all first pairs are present in the certificate} we know that $o$ must be the second member of a pair in $\lst P$;  let $j$ be the index of the pair such that $p_2(\lst P_j)=o$.  Let $a := o$ and $b := p_1(\lst P_i)$.

Let $b'$ and $\set Q := \set R'$ be as defined in Corolary \ref{recombination-to-make-commute} given the pair $(a,b)$ and the sequence $\set R := \set Q'$.  Let $\lst O^{(l)}_i=b'$ if $\lst O^{(l)}_i=b$, and otherwise 
$$
\lst O^{(l)}_i :=
\begin{cases}
\lst O'^{(l)}_i & l < n'\\
\begin{cases}
\lst O'^{(l)}_i & l = n', i \le |\lst O'^{(l)}_i|\\
o & l = n, i = |\lst O'^{(l)}_i|+1\\
\end{cases} & n = n' \\
\begin{cases}
\lst O'^{(l)}_i & l = n'\\
o & l = n, i = 1
\end{cases} & n > n'
\end{cases}
$$
(Note that $\lst O^{(l)}$ is the empty sequence for $n>n'$ and $n' < l < n$.)

First we need to establish that $\lst P$ is a choice of qubits.  We shall defer the proof that the pairs are conjugal until we prove property \ref{pairs are all conjugal to R}, so it remains only to show that $M^{(|\lst P|)}(\lst P)$ is ordered.  To do this, we note that by the inductive hypothesis we conclude from properties \ref{all first pairs are present in the certificate} and \ref{O has the certificate property} that there is an  undetectable error of weight $\om_{\set S}(b)$ that acts on $b$ but not on any operator in $\set U(\set Q')$, and furthermore by property \ref{nothing smaller in Q} we observe that there is no undetectable error acting on any operator in $\set U(\set Q')$ that has a smaller weight than this error;  hence, $\om_{\set S}(b')=\om_{\set S}(b)$, and so $M^{(|\lst P|)}(\lst P)=M^{(|\lst P|)}(\lst P')$.

We shall now prove that all of the listed conclusions hold.
\begin{enumerate}
% 1
\item By the inductive hypothesis we know that the pairs in $\lst P'$ and $\set Q'$ are all conjugal with respect to $\set R' := \set U(\lst P')\cup \set U(\set Q')\cup \set S$, and by Lemma \ref{multiple-recombinations} we know that the pair $(a,b')$ and the set of pairs $\set Q$ are all conjugal pairs with respect to
$$\left[\set R'\backslash\paren{\{a,b\} \cup \set U(\set Q')}\right]\cup \{a,b'\} \cup \set U(\set Q)=\set R.$$
% 2
\item By the inductive hypothesis we know that $\genfun\paren{\set U(\lst P')\cup \set U(\set Q')}=(\genfun\circ\set U)(\set L)$, and by Lemma \ref{multiple-recombinations} we know that $\genfun\paren{\{a,b'\}\cup \set U(\lst Q')}=\genfun\paren{\{a,b\}\cup \set U(\lst Q)}$.  Hence we conclude that $\genfun\paren{\set U(\lst P)\cup \set U(\set Q)}=(\genfun\circ\set U)(\set L)$.
% 3
\item Since $M^{(|\lst P|)}(\lst P)=M^{(|\lst P|)}(\lst P')$ (as we showed earlier), we conclude immediately that $n \ge n' \ge m_{\set S}(\lst P_{|\lst P|})$.

Next, note that the only difference between $\paren{\set U(\lst P') \backslash \bigcup_l \set U(\lst O'^{(l)})}$ and $\paren{\set U(\lst P) \backslash \bigcup_l \set U(\lst O^{(l)})}$ is the removal of an operator, so we conclude from the inductive hypothesis that $\om_{\set S}(y)\ge m_{\set S}(\lst P_{|\lst P|})$ for all $y\in \paren{\set U(\lst P) \backslash \bigcup_l \set U(\lst O^{(l)})}$

Finally, from Corolary \ref{recombination-to-make-commute} we also know that $\min_{y\in \set U(\set Q)}\om_{\set S}(y)\ge \min\paren{\om_{\set S}(o),\min_{y\in \set U(\set Q;)}\om_{\set S}(y)}$.  Since $o$ and every element of $\set Q'$ are members of $\set X'$, we conclude from the inductive hypothesis that $\om_{\set S}(y)\ge m_{\set S}(\lst P_{|\lst P|}$ for every $y\in \set U(\set Q)$.

From the results of the previous two paragraphs, we conclude that $\om_{\set S}(y)\ge m_{\set S}(\lst P_{|\lst P|}$ for every $y\in \set X$.
% 4
\item This follows from the fact that $\left|\{\lst O'^{(l)}\}_{l,i}\right| = k-1$ by the inductive hypothesis and by construction the set $\{\lst O^{(l)}\}_{l,i}$ has one changed element and one additional element.
% 5
\item This follows from the construction of $\lst O^{(l)}$ from $\lst O^{(l)}$, in which we added an element in $\set U(\lst P)$ and changed the only element that had changed from $\set U(\lst P')$ to $\set U(\lst P)$.
% 6
\item This follows using the same argument used to show property \ref{certificate is subset of the choice of qubits}.
% 7
\item This also using the same argument used to show property \ref{certificate is subset of the choice of qubits}.
% 8
\item
Note that every operator in $\set X$ is the product of operators in $\set X'$;  hence, for every operator $\lst O'^{(l)}_i$ the undetectable error that acts on $\lst O'^{(l)}_i$ but not on any operator in $\lst X'$ that we know exists from the inductive hypothesis must also not act on any operator $\lst X$.  Thus, we conclude that this property is immediately satisfied for every sequence $\lst O^{(l)}$ such that $\lst O^{(l)}=\lst O'^{(l)}$.  Furthermore, we also conclude that this property is satisfied vacuously for every empty sequence.  Thus, there are only two sequences remaining for us to consider:  the one that contains $b'$, and the one to which we added $o$;  note that it is possible that these are the same sequence.

Let $l$ and $i$ be the integers such that $\lst O'^{(l)}_i=b$.  From the inductive hypothesis we know from property \ref{O has the certificate property, extending to X} that there exists an undetectable error $y$ of weight $l$ that acts on $b$ but not on any element in $\{\lst O'^{(l)}_i : i > j\} \cup \set X$.  There are two consequences of this.  first, since $b'$ is a product of $b$ and elements from $\set U(\set Q')\subseteq\set X$, this means that $y$ must anti-commute with and hence act on $b'$.  Thus, by the inductive hypothesis, $y$ must commute with and hence not act on every element in $\{\lst O^{(l)}_i : i > j\}$;  note that this continues to be true even if $o$ appears at the end of $\lst O^{(l)}$, since $o\in\set X'$.  Furthermore, by the same reasoning used in the previous paragraph, $y$ must commute with and hence not act on every operator in $\set X$.

Now let $l$ be the integer such that $\lst O^{(l)}_{|\lst O^{(l)}|}=o$.  For every operator $\lst O^{(l)}_i$ such that $i<|\lst O^{(l)}|$ we know that there must be an undetectable error that acts on $\lst O^{(l)}_i$ but not on $o$ since $\lst O^{(l)}_i=\lst O'^{(l)}_i$ and $o\in \set X'$.  Furthermore, every operator in $\set X$ is either an operator in $\set X'$ that commutes with $x$ or the product of $o$ with an operator that anti-commutes with $x$;  hence, there exists an undetectable error --- namely, $x$ --- that acts on $o$ but not on any operator in $\set X$.
\end{enumerate}
\end{description}

\end{proof}

\end{comment}
%@-node:gcross.20100126164527.1286:Proposition: Creation of certificate
%@+node:gcross.20100127211423.1361:Proposition: Creation of certificate
\begin{theorem}
Suppose we are given a set of $N$ pairs $\set L$ and a set of Pauli operators $\set S$ such that every pair in $\set L$ is conjugal with respect to $\set U(\set L)\cup\set S$.  Then for every $0\le k \le 2N$, there exist
\begin{itemize}
\item a choice of qubits $\lst P$ stabilized by $\set S$;
\item a set of pairs, $\set Q$;
\item and an unimproveable set of operators $\set O$ with respect to $\set S$;
\end{itemize}
such that, letting $\set X:=\set U(\set Q) \cup \paren{\set U(\lst P) \backslash \bigcup_l \set U(\lst O^{(l)})}$, we have that
\begin{enumerate}
% 1
\item \label{pairs are all conjugal to R} the pairs in $\lst P$ and $\set Q$ are all conjugal with respect to $\set R := \set U(\lst P)\cup \set U(\set Q)\cup \set S$;
% 2
\item $\genfun\paren{\set U(\lst P)\cup \set U(\set Q)}=(\genfun\circ\set U)(\set L)$;
\item and for every $x\in\set X$ and $o\in\set O$ we have that $[o,x]=0$.
\end{enumerate}
\end{theorem}

\begin{proof}

Proof by induction.  For the base case, let $n=0$ and $\lst P'$ be the empty sequence;  then the conclusions are satisfied vacuously.

Now assume that this Proposition has been proven for some integer $k-1$;  let $\lst P'$, $\lst Q'$, $\set O$ and $\set X'$ be the named objects (without the primes) obtained by recursively applying this Proposition to the integer $k-1$  Let $f$ be the minimizer of $w$ over the set $\bigcup_{o\in\set X'} \set e_{\set S}(o)$.  Let $x$ be either $p_2(\lst P_i)$ for the smallest $i$ such that $\{p_2(\lst P_i),w\}=0$, or if there is no such $i$ then let $x$ be any arbitrarily chosen operator such that $x\in \set e_{\set S}(o)$.  Finally, let  $d:=\om_{\set S}(o)$.

There are two cases;  either
\begin{enumerate}
\item $o\in \set U(\lst P)$;
\item or $o\notin \set U(\lst P)$ and $o\in\set U(\set Q)$.
\end{enumerate}

\begin{description}

\item[Case 1 $\Rightarrow o\in\set U(\lst P)$]

\end{description}

\end{proof}
%@nonl
%@-node:gcross.20100127211423.1361:Proposition: Creation of certificate
%@+node:gcross.20100119183304.1293:Definition: Certificate
This last definition gives us a precise notion of what it means to have made the best choice of logical qubits.  However, we now need a way to prove that given choice of qubits is optimal.  We do this by means of a certificate, which is defined as follows:

\begin{definition}
Suppose we are given
\begin{itemize}
\item a choice of $N$ qubits, $\lst P$ stabilized by some set $\set S$;
\item a sequence $\lst E$ of $N$ Pauli operators such that for every $i\in\{1\dots N\}$, we have that
\begin{enumerate}
\item $\lst E_i$ is an undetectable error (with respect to $\set S$) acting on $p_1(\lst P_i)$;
\item $\lst E_i$ commutes with $p_2(\lst P_i)$;
\item $w(\lst E_i)=m(\lst P_i)$; and
\item $\lst E_i$ commutes with every operator in $\set U\paren{\{\lst P_j:j>i\}}$, i.e. with every operator in every pair after the $i$-th pair in the sequence.
\end{enumerate}
\item a sequence $\lst F$ of $N$ Pauli operators such that for every $i\in\{1\dots N\}$, we have that either $\lst F_i=I$ and $(\om_{\set S} \circ p_2)(\lst P_i) \ge w(\lst E_N)$, or else all of the following properties are satisfied
\begin{enumerate}
\item $\lst F_i$ is an undetectable error (with respect to $\set S$) acting on $p_2(\lst P_i)$;
\item $w\paren{\lst F_i}=(\om_{\set S} \circ p_2)(\lst P_i)$;
\item $\lst F_i$ commutes with every operator in $\set U\paren{\{\lst P_j:j>i\}}$, i.e. with every operator in every pair after the $i$-th pair in the sequence.
\end{enumerate}
\end{itemize}
Then the tuple $(\lst E,\lst F)$ is a \emph{certificate} for $\lst P$.
\end{definition}

Now we shall prove that the presence of a certificate signals optimality via the following Proposition.
%@nonl
%@-node:gcross.20100119183304.1293:Definition: Certificate
%@+node:gcross.20100119183304.1292:Proposition: Creation of certificate
%@+node:gcross.20100119183304.1294:Statement
We have shown that if we have a certificate for a choice of qubits then it is an optimal choice.  However, this is useless to us unless we can show that a choice of qubits can be constructed that has a certificate.  This is done via the following Proposition.

\begin{proposition}
\label{certificate-creation}
Suppose we are given a set of pairs $\set L$ and a set of Pauli operators $\set S$ such that every pair in $\set L$ is a conjugal pair with respect to $\set U(\set L)\cup\set S$.  Then for every integer $k\in\{0\dots 2N\}$, there exists a choice of qubits $\lst P$ stabilized by $\set S$, a set of conjugul pairs $\set Q$, and a certificate $(\lst E,\lst F)$ for $\lst P$ such that
\begin{enumerate}
\item the pairs in $\lst P$ and $\set Q$ are all conjugal with respect to $U(\lst P)\cup U(\set Q)\cup \set S$;
\item $\genfun\paren{U(\lst P)\cup U(\set Q)}=(\genfun\circ\set U)(\set L)$;
\item every operator in $\set U(\set Q)$ commutes with every operator in $\lst E$ and $\lst F$;
\item $m(X)\ge w(\lst E_n)$ for every $X\in\set Q$;
\item $|\lst E|+|\{\lst F_i : \lst F_i\ne I\}|=k$;
\end{enumerate}
\end{proposition}
%@-node:gcross.20100119183304.1294:Statement
%@+node:gcross.20100122140843.1282:Definition
For convenience, we introduce the following definitions:

\begin{definition}
Given any two sequences of integers taken from $\{0,1\}$, $\lst l^{(1)}$ and $\lst l^{(2)}$, we define the (indexed) function $\set X_{\lst l}$ as a map from a sequence of pairs of Pauli operators of length $|\lst l^{(k)}|$ to $\powerset(\pauligroup)$ such that
$$\set X_{\lst l}(\lst P) := \{p_{3-k}(\lst P_i) : k \in \{1,2\}, i \in \{1\dots |\lst P|\}, l^{(k)}_i=1\}.$$
\end{definition}
%@-node:gcross.20100122140843.1282:Definition
%@+node:gcross.20100125114620.1284:Lemmas
First, we need the following Lemmas:
%@+node:gcross.20100123143948.1298:Lemma: Unchanged error weight
\begin{lemma}
\label{unchanged-error-weight}
Suppose we are given a set $\set S$, an operator $x$ such that $\om_{\set S}(x)=d$, and an operator $y$ such that $\om_{\set S}(y) \ge \om_{\set S}(x)$ and $[y,o]=0$ for some $o\in\set e_{\set S}(x)$.  Then $\om_{\set S}(x\cdot y)=\om_{\set S}(x)$.
\end{lemma}

\begin{proof}
Since $[x,o]=0$ for some $o\in\set e_{\set S}(x)$, we have that $\{o\cdot x,e_{\set S}(o)\}=0$.  Furthermore, we know that there is no undetectable error with weight less than $\om_{\set S}(x)$ that acts on either $x$ or $y$ and hence on the product $x\cdot y$.  Thus, $o$ is the undetectable error acting on $x\cdot y$ of minimum weight and so $\om_{\set S}(x\cdot y)=w(o)=\om_{\set S}(x)$.
\end{proof}
%@-node:gcross.20100123143948.1298:Lemma: Unchanged error weight
%@-node:gcross.20100125114620.1284:Lemmas
%@+node:gcross.20100119183304.1295:Proof
Now to prove Proposition \ref{certificate-creation}.

\begin{proof}[of Proposition \ref{certificate-creation}]

Proof by induction.  For the base case, $k=0$, observe that the listed properties hold vacuously for $\set E=\lst F=\lst P=\emptyset$ and $\set Q=\set L$.

Now suppose that we have proven this Proposition for the sets $\set L$, $\set S$, and the integer $k-1$.  We shall now prove it for the integer $k$.

By recursive application of this Proposition, we obtain the objects (without the primes) $\lst P'$, $\set Q'$, $\lst E'$, and $\lst F'$.  Let $o$ be the minimizer of $\om_{\set S}$ over the set $\set U(\set Q') \cup \{p_2(\lst P_i'):\lst F_i' \ne I\}$.  There are two cases that shall be addressed separately; either

\begin{enumerate}
\item $o\in\{p_2(\lst P_i'):\lst F_i' \ne I\}$, or
\item $o\notin\{p_2(\lst P_i):\lst F_i' \ne I\}$ and $o\in\set U(\set Q')$.
\end{enumerate}

\begin{description}

\item[Case 1 $\Rightarrow o\in\{p_2(\lst P_i'):\lst F_i' \ne I\}$]
%@<< Case 1: fill in a value of F >>
%@+node:gcross.20100125114620.1285:<< Case 1: fill in a value of F >>
Let $m$ be the smallest integer such that $\{o,\lst F_m'\}=0$, and let $(b,a):=\lst P'_m$.  Place some arbitrary ordering on $\set Q'$ to form the sequence $\lst Q'$, and then let
$$\lst O_i :=
\begin{cases}
\lst P'_{m+i} & 1 \le i \le N-m \\
\lst Q'_{i-N-m} & N-m+1 \le i \le N-m+|\lst Q|, \\
\end{cases}
$$
and
$$\lst l^{(j)}_i :=
\begin{cases}
0 & [p_j(\lst O_i),o] = 0 \\
1 & \{p_j(\lst O_i),o\} = 0. \\
\end{cases}
$$
Apply Lemma \ref{multiple-recombinations} to respectively the pair $(a,b)$, the sequence $\lst O$, and the set $U(\lst P')\cup U(\set Q')\cup \set S$, and let $(a,b')$ refer to $\lst O'$ the object with the same names in Lemma \ref{multiple-recombinations}.  Now let $\lst E':= \lst E$,
$$\lst F_i := 
\begin{cases}
o & i = m \\
\lst F'_i & \text{otherwise},
\end{cases}
\quad
\lst P_i :=
\begin{cases}
\lst P'_i & i < m \\
(b',a) & i = m \\
\lst O'_{i-k} & i > m, \\
\end{cases}
$$
and $\set Q := \{\lst O'_i : i \ge N-k+1\}$.

Now we need to prove that these objects satisfy the conclusions of this Lemma.  First, note that since the only change in $\lst E$ and $\lst F$ from $\lst E'$ and $\lst F'$ was the change of $\lst F_m$ from the identity to $o$;  we know that $o$ is not the identity because it anti-commutes with another operator, and hence since this is the only change we conclude that $|\lst E|+|\{\lst F_i : \lst F_i\ne I\}|=|\lst E'|+|\{\lst F_i' : \lst F_i'\ne I\}|+1=k-1+1=k$.

Next we observe that all the elements of $\lst P$ and $\set Q$ which were changed from $\lst P'$ and $\set Q'$ did so by passing through Lemma \ref{multiple-recombinations};  thus, we conclude that $\lst P$ and $\set Q$ are sets of conjugal pairs with respect to $U(\lst P)\cup U(\set Q)\cup \set S$, and also that $\genfun\paren{U(\lst P)\cup U(\set Q)}=\genfun\paren{U(\lst P')\cup U(\set Q')}=(\genfun\circ\set U)(\set L)$.

Now observe that every operator in $\set U(\set Q')$ commutes with every element in $\lst E$ and $\lst F$ except for possibly $\lst F_m$, and every operator in $\set U(\set Q)$ corresponds to either an element in $\set U(\set Q')$ which commutes with $\lst F_m$ or an element in $\set U(\set Q')$ which anti-commutes with $\lst F_m$ but was multipled by $p_2(\lst P_m)$, and we know that $p_2(\lst P_m)=p_2(\lst P_m')$ anti-commutes with $\lst F_m$ (by the definition of $m$) and commutes with every other member of $\lst E$ and $\lst F$ (by recursive application of this Lemma).  Thus, $\set Q$ satisfies the property that every operator in $\set U(\set Q)$ commutes with every operator in $\lst E$ and $\lst F$.

By recursive application of this Lemma we know that $(\lst F',\lst E')$ is a certificate for $\lst P'$, and so since $\lst F'_m=I$ by our choice of $m$ we know that $(\om_{\set S}\circ p_2)(\lst P_m)=(\om_{\set S}\circ p_2)(\lst P_m')\ge w(\lst E_n)$;  furthermore, we also know that $m(X)\ge w(\lst E_n)$ for every $X\in \set Q'$.  Since every operator in $\set U(\set Q)$ is either an operator or a product of two operators whose minimum weight error has a weight no less than $w(\lst E_n)$, by Lemma \ref{combinations-can't-make-things-worse} we conclude that $m(X)\ge w(\lst E_n)$ for every $X\in \set Q$.

It remains to prove that $\lst P$ is a choice of qubits stabilized by $\set S$ and that $(\lst E,\lst F)$ are a certificate for it.  Observe that to prove $\lst P$ is a choice of qubits it suffices at this point for us to show that $m(\lst P_i)=m(\lst P'_i)$, and for this there are three cases to consider: $i<m$, $i=m$, and $i>m$:

\begin{description}
\item[Case 1 $\Rightarrow i < m$]
In this case, we have that $\lst P_i=\lst P'_i$ and so $m(\lst P_i)=m(\lst P'_i)$.

\item[Case 2 $\Rightarrow i = m$]
In this case, we have that $p_2(\lst P_m)=p_2(\lst P'_m)$ and $p_1(\lst P_m)$ is a product of $p_1(\lst P_m)$ and a set of operators selected from the subset $\set O := \set U\paren{\{\lst P_i' : i > m \}}$, for which we know that $[o,\lst E_i]=0$ and $\om_{\set S}(o)\ge \om_{\set S}(p_1(\lst P'_m))=w(\lst E_m)$ for every $o\in \set O$;  thus, by Lemma \ref{unchanged-error-weight} we conclude that $\om_{\set S}(\lst P_m)=\om_{\set S}(\lst P'_m)$ and hence $m(\lst P_m)=m(\lst P'_m).$

\item[Case 3 $\Rightarrow i > m$]
In this case, we have that $p_2(\lst P_i)=p_2(\lst P'_i)$ and $p_1(\lst P_i)$ is either $p_1(\lst P'_i)$ or a product of $p_1(\lst P'_i)$ and $\lst F_m$, and 
\end{description}
%@-node:gcross.20100125114620.1285:<< Case 1: fill in a value of F >>
%@nl

\item[Case 2]
%@<< Case 2: extract a qubit >>
%@+node:gcross.20100125114620.1286:<< Case 2: extract a qubit >>
%@-node:gcross.20100125114620.1286:<< Case 2: extract a qubit >>
%@nl

\end{description}

\end{proof}
%@-node:gcross.20100119183304.1295:Proof
%@-node:gcross.20100119183304.1292:Proposition: Creation of certificate
%@-others
%@-node:gcross.20090511123440.3:Optimal generators
%@-node:gcross.20090423002455.2:Algorithm
%@-others

\end{document}
%@nonl
%@-node:gcross.20090405101642.3:@thin CodeQuest.tex
%@-leo
